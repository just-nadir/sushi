generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CUSTOMER
}

enum OrderStatus {
  NEW
  CONFIRMED
  COOKING
  READY
  DELIVERY
  COMPLETED
  DELIVERED // Legacy? Keeping it just in case
  CANCELLED
}

enum OrderType {
  DELIVERY
  PICKUP
}

model User {
  id        String   @id @default(uuid())
  telegramId String? @unique // For Telegram Users
  username  String? // Telegram Username
  fullName  String?
  phone     String?
  password  String? // For Admin login
  role      Role     @default(CUSTOMER)
  
  orders    Order[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id        String    @id @default(uuid())
  name      String
  image     String?
  sortOrder Int       @default(0)
  products  Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id          String   @id @default(uuid())
  name        String
  description String?
  price       Float
  image       String?
  isAvailable Boolean  @default(true)
  
  category    Category @relation(fields: [categoryId], references: [id])
  categoryId  String
  
  orderItems  OrderItem[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Order {
  id          Int         @id @default(autoincrement()) // Short readable ID for orders
  status      OrderStatus @default(NEW)
  type        OrderType   @default(DELIVERY)
  totalAmount Float
  deliveryPrice Float @default(0)
  
  address     String?
  locationLat Float?
  locationLon Float?
  comment     String?

  user        User?       @relation(fields: [userId], references: [id])
  userId      String?

  items       OrderItem[]

  // Guest Info
  customerName  String?
  customerPhone String?
  paymentType   String   @default("CASH") // CASH, CLICK, PAYME

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model OrderItem {
  id        String  @id @default(uuid())
  quantity  Int
  price     Float   // Snapshot price
  
  product   Product @relation(fields: [productId], references: [id])
  productId String
  
  order     Order   @relation(fields: [orderId], references: [id])
  orderId   Int
}

model Setting {
  key       String   @id
  value     String
  description String?
  
  updatedAt DateTime @updatedAt
}
